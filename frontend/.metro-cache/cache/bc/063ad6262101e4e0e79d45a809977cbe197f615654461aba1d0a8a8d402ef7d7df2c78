{"dependencies":[],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  /*\n   * Copyright 2022 gRPC authors.\n   *\n   * Licensed under the Apache License, Version 2.0 (the \"License\");\n   * you may not use this file except in compliance with the License.\n   * You may obtain a copy of the License at\n   *\n   *     http://www.apache.org/licenses/LICENSE-2.0\n   *\n   * Unless required by applicable law or agreed to in writing, software\n   * distributed under the License is distributed on an \"AS IS\" BASIS,\n   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n   * See the License for the specific language governing permissions and\n   * limitations under the License.\n   *\n   */\n  Object.defineProperty(exports, \"__esModule\", {\n    value: true\n  });\n  exports.InterceptingListenerImpl = exports.isInterceptingListener = void 0;\n  function isInterceptingListener(listener) {\n    return listener.onReceiveMetadata !== undefined && listener.onReceiveMetadata.length === 1;\n  }\n  exports.isInterceptingListener = isInterceptingListener;\n  class InterceptingListenerImpl {\n    constructor(listener, nextListener) {\n      this.listener = listener;\n      this.nextListener = nextListener;\n      this.processingMetadata = false;\n      this.hasPendingMessage = false;\n      this.processingMessage = false;\n      this.pendingStatus = null;\n    }\n    processPendingMessage() {\n      if (this.hasPendingMessage) {\n        this.nextListener.onReceiveMessage(this.pendingMessage);\n        this.pendingMessage = null;\n        this.hasPendingMessage = false;\n      }\n    }\n    processPendingStatus() {\n      if (this.pendingStatus) {\n        this.nextListener.onReceiveStatus(this.pendingStatus);\n      }\n    }\n    onReceiveMetadata(metadata) {\n      this.processingMetadata = true;\n      this.listener.onReceiveMetadata(metadata, metadata => {\n        this.processingMetadata = false;\n        this.nextListener.onReceiveMetadata(metadata);\n        this.processPendingMessage();\n        this.processPendingStatus();\n      });\n    }\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    onReceiveMessage(message) {\n      /* If this listener processes messages asynchronously, the last message may\n       * be reordered with respect to the status */\n      this.processingMessage = true;\n      this.listener.onReceiveMessage(message, msg => {\n        this.processingMessage = false;\n        if (this.processingMetadata) {\n          this.pendingMessage = msg;\n          this.hasPendingMessage = true;\n        } else {\n          this.nextListener.onReceiveMessage(msg);\n          this.processPendingStatus();\n        }\n      });\n    }\n    onReceiveStatus(status) {\n      this.listener.onReceiveStatus(status, processedStatus => {\n        if (this.processingMetadata || this.processingMessage) {\n          this.pendingStatus = processedStatus;\n        } else {\n          this.nextListener.onReceiveStatus(processedStatus);\n        }\n      });\n    }\n  }\n  exports.InterceptingListenerImpl = InterceptingListenerImpl;\n});","lineCount":85,"map":[[2,2,1,0],[2,14,1,12],[4,2,2,0],[5,0,3,0],[6,0,4,0],[7,0,5,0],[8,0,6,0],[9,0,7,0],[10,0,8,0],[11,0,9,0],[12,0,10,0],[13,0,11,0],[14,0,12,0],[15,0,13,0],[16,0,14,0],[17,0,15,0],[18,0,16,0],[19,0,17,0],[20,2,18,0,"Object"],[20,8,18,6],[20,9,18,7,"defineProperty"],[20,23,18,21],[20,24,18,22,"exports"],[20,31,18,29],[20,33,18,31],[20,45,18,43],[20,47,18,45],[21,4,18,47,"value"],[21,9,18,52],[21,11,18,54],[22,2,18,59],[22,3,18,60],[22,4,18,61],[23,2,19,0,"exports"],[23,9,19,7],[23,10,19,8,"InterceptingListenerImpl"],[23,34,19,32],[23,37,19,35,"exports"],[23,44,19,42],[23,45,19,43,"isInterceptingListener"],[23,67,19,65],[23,70,19,68],[23,75,19,73],[23,76,19,74],[24,2,20,0],[24,11,20,9,"isInterceptingListener"],[24,33,20,31,"isInterceptingListener"],[24,34,20,32,"listener"],[24,42,20,40],[24,44,20,42],[25,4,21,4],[25,11,21,12,"listener"],[25,19,21,20],[25,20,21,21,"onReceiveMetadata"],[25,37,21,38],[25,42,21,43,"undefined"],[25,51,21,52],[25,55,22,8,"listener"],[25,63,22,16],[25,64,22,17,"onReceiveMetadata"],[25,81,22,34],[25,82,22,35,"length"],[25,88,22,41],[25,93,22,46],[25,94,22,47],[26,2,23,0],[27,2,24,0,"exports"],[27,9,24,7],[27,10,24,8,"isInterceptingListener"],[27,32,24,30],[27,35,24,33,"isInterceptingListener"],[27,57,24,55],[28,2,25,0],[28,8,25,6,"InterceptingListenerImpl"],[28,32,25,30],[28,33,25,31],[29,4,26,4,"constructor"],[29,15,26,15,"constructor"],[29,16,26,16,"listener"],[29,24,26,24],[29,26,26,26,"nextListener"],[29,38,26,38],[29,40,26,40],[30,6,27,8],[30,10,27,12],[30,11,27,13,"listener"],[30,19,27,21],[30,22,27,24,"listener"],[30,30,27,32],[31,6,28,8],[31,10,28,12],[31,11,28,13,"nextListener"],[31,23,28,25],[31,26,28,28,"nextListener"],[31,38,28,40],[32,6,29,8],[32,10,29,12],[32,11,29,13,"processingMetadata"],[32,29,29,31],[32,32,29,34],[32,37,29,39],[33,6,30,8],[33,10,30,12],[33,11,30,13,"hasPendingMessage"],[33,28,30,30],[33,31,30,33],[33,36,30,38],[34,6,31,8],[34,10,31,12],[34,11,31,13,"processingMessage"],[34,28,31,30],[34,31,31,33],[34,36,31,38],[35,6,32,8],[35,10,32,12],[35,11,32,13,"pendingStatus"],[35,24,32,26],[35,27,32,29],[35,31,32,33],[36,4,33,4],[37,4,34,4,"processPendingMessage"],[37,25,34,25,"processPendingMessage"],[37,26,34,25],[37,28,34,28],[38,6,35,8],[38,10,35,12],[38,14,35,16],[38,15,35,17,"hasPendingMessage"],[38,32,35,34],[38,34,35,36],[39,8,36,12],[39,12,36,16],[39,13,36,17,"nextListener"],[39,25,36,29],[39,26,36,30,"onReceiveMessage"],[39,42,36,46],[39,43,36,47],[39,47,36,51],[39,48,36,52,"pendingMessage"],[39,62,36,66],[39,63,36,67],[40,8,37,12],[40,12,37,16],[40,13,37,17,"pendingMessage"],[40,27,37,31],[40,30,37,34],[40,34,37,38],[41,8,38,12],[41,12,38,16],[41,13,38,17,"hasPendingMessage"],[41,30,38,34],[41,33,38,37],[41,38,38,42],[42,6,39,8],[43,4,40,4],[44,4,41,4,"processPendingStatus"],[44,24,41,24,"processPendingStatus"],[44,25,41,24],[44,27,41,27],[45,6,42,8],[45,10,42,12],[45,14,42,16],[45,15,42,17,"pendingStatus"],[45,28,42,30],[45,30,42,32],[46,8,43,12],[46,12,43,16],[46,13,43,17,"nextListener"],[46,25,43,29],[46,26,43,30,"onReceiveStatus"],[46,41,43,45],[46,42,43,46],[46,46,43,50],[46,47,43,51,"pendingStatus"],[46,60,43,64],[46,61,43,65],[47,6,44,8],[48,4,45,4],[49,4,46,4,"onReceiveMetadata"],[49,21,46,21,"onReceiveMetadata"],[49,22,46,22,"metadata"],[49,30,46,30],[49,32,46,32],[50,6,47,8],[50,10,47,12],[50,11,47,13,"processingMetadata"],[50,29,47,31],[50,32,47,34],[50,36,47,38],[51,6,48,8],[51,10,48,12],[51,11,48,13,"listener"],[51,19,48,21],[51,20,48,22,"onReceiveMetadata"],[51,37,48,39],[51,38,48,40,"metadata"],[51,46,48,48],[51,48,48,50,"metadata"],[51,56,48,58],[51,60,48,62],[52,8,49,12],[52,12,49,16],[52,13,49,17,"processingMetadata"],[52,31,49,35],[52,34,49,38],[52,39,49,43],[53,8,50,12],[53,12,50,16],[53,13,50,17,"nextListener"],[53,25,50,29],[53,26,50,30,"onReceiveMetadata"],[53,43,50,47],[53,44,50,48,"metadata"],[53,52,50,56],[53,53,50,57],[54,8,51,12],[54,12,51,16],[54,13,51,17,"processPendingMessage"],[54,34,51,38],[54,35,51,39],[54,36,51,40],[55,8,52,12],[55,12,52,16],[55,13,52,17,"processPendingStatus"],[55,33,52,37],[55,34,52,38],[55,35,52,39],[56,6,53,8],[56,7,53,9],[56,8,53,10],[57,4,54,4],[58,4,55,4],[59,4,56,4,"onReceiveMessage"],[59,20,56,20,"onReceiveMessage"],[59,21,56,21,"message"],[59,28,56,28],[59,30,56,30],[60,6,57,8],[61,0,58,0],[62,6,59,8],[62,10,59,12],[62,11,59,13,"processingMessage"],[62,28,59,30],[62,31,59,33],[62,35,59,37],[63,6,60,8],[63,10,60,12],[63,11,60,13,"listener"],[63,19,60,21],[63,20,60,22,"onReceiveMessage"],[63,36,60,38],[63,37,60,39,"message"],[63,44,60,46],[63,46,60,48,"msg"],[63,49,60,51],[63,53,60,55],[64,8,61,12],[64,12,61,16],[64,13,61,17,"processingMessage"],[64,30,61,34],[64,33,61,37],[64,38,61,42],[65,8,62,12],[65,12,62,16],[65,16,62,20],[65,17,62,21,"processingMetadata"],[65,35,62,39],[65,37,62,41],[66,10,63,16],[66,14,63,20],[66,15,63,21,"pendingMessage"],[66,29,63,35],[66,32,63,38,"msg"],[66,35,63,41],[67,10,64,16],[67,14,64,20],[67,15,64,21,"hasPendingMessage"],[67,32,64,38],[67,35,64,41],[67,39,64,45],[68,8,65,12],[68,9,65,13],[68,15,66,17],[69,10,67,16],[69,14,67,20],[69,15,67,21,"nextListener"],[69,27,67,33],[69,28,67,34,"onReceiveMessage"],[69,44,67,50],[69,45,67,51,"msg"],[69,48,67,54],[69,49,67,55],[70,10,68,16],[70,14,68,20],[70,15,68,21,"processPendingStatus"],[70,35,68,41],[70,36,68,42],[70,37,68,43],[71,8,69,12],[72,6,70,8],[72,7,70,9],[72,8,70,10],[73,4,71,4],[74,4,72,4,"onReceiveStatus"],[74,19,72,19,"onReceiveStatus"],[74,20,72,20,"status"],[74,26,72,26],[74,28,72,28],[75,6,73,8],[75,10,73,12],[75,11,73,13,"listener"],[75,19,73,21],[75,20,73,22,"onReceiveStatus"],[75,35,73,37],[75,36,73,38,"status"],[75,42,73,44],[75,44,73,46,"processedStatus"],[75,59,73,61],[75,63,73,65],[76,8,74,12],[76,12,74,16],[76,16,74,20],[76,17,74,21,"processingMetadata"],[76,35,74,39],[76,39,74,43],[76,43,74,47],[76,44,74,48,"processingMessage"],[76,61,74,65],[76,63,74,67],[77,10,75,16],[77,14,75,20],[77,15,75,21,"pendingStatus"],[77,28,75,34],[77,31,75,37,"processedStatus"],[77,46,75,52],[78,8,76,12],[78,9,76,13],[78,15,77,17],[79,10,78,16],[79,14,78,20],[79,15,78,21,"nextListener"],[79,27,78,33],[79,28,78,34,"onReceiveStatus"],[79,43,78,49],[79,44,78,50,"processedStatus"],[79,59,78,65],[79,60,78,66],[80,8,79,12],[81,6,80,8],[81,7,80,9],[81,8,80,10],[82,4,81,4],[83,2,82,0],[84,2,83,0,"exports"],[84,9,83,7],[84,10,83,8,"InterceptingListenerImpl"],[84,34,83,32],[84,37,83,35,"InterceptingListenerImpl"],[84,61,83,59],[85,0,83,60],[85,3]],"functionMap":{"names":["<global>","isInterceptingListener","InterceptingListenerImpl","InterceptingListenerImpl#constructor","InterceptingListenerImpl#processPendingMessage","InterceptingListenerImpl#processPendingStatus","InterceptingListenerImpl#onReceiveMetadata","listener.onReceiveMetadata$argument_1","InterceptingListenerImpl#onReceiveMessage","listener.onReceiveMessage$argument_1","InterceptingListenerImpl#onReceiveStatus","listener.onReceiveStatus$argument_1"],"mappings":"AAA;ACmB;CDG;AEE;ICC;KDO;IEC;KFM;IGC;KHI;IIC;kDCE;SDK;KJC;IME;gDCI;SDU;KNC;IQC;8CCC;SDO;KRC;CFC"},"hasCjsExports":true},"type":"js/module"}]}